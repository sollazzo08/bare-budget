generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int    @id @default(autoincrement())
  username     String @unique @db.VarChar(254)
  email        String @unique @db.VarChar(254)
  passwordHash String @db.VarChar(127)

  accounts     Account[]
  transactions Transaction[]
  budgets      Budget[]

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  lastLogin  DateTime?
  deletedAt  DateTime?
  categories Category[]
}

model Account {
  id     Int @id @default(autoincrement())
  userId Int

  // e.g. "TD Checking", "Chase Freedom"
  name String @db.VarChar(50)

  // e.g. "checking", "savings", "credit"
  type String @db.VarChar(30)

  balance Decimal @default(0) @db.Decimal(12, 2)

  user         User          @relation(fields: [userId], references: [id])
  transactions Transaction[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Category {
  id     Int    @id @default(autoincrement())
  name   String @db.VarChar(50)
  userId Int?

  user         User?         @relation(fields: [userId], references: [id])
  transactions Transaction[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Budget {
  id     Int @id @default(autoincrement())
  userId Int

  // e.g. "Groceries", "Dining", etc.
  name String @db.VarChar(50)

  // first day of the month this budget applies to, e.g. 2025-11-01
  month DateTime

  amount Decimal @db.Decimal(12, 2)

  user User @relation(fields: [userId], references: [id])

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
  transactions Transaction[]
}

model Transaction {
  id Int @id @default(autoincrement())

  userId     Int
  accountId  Int
  categoryId Int?
  budgetId   Int?

  // signed: negative = expense, positive = income
  amount Decimal @db.Decimal(12, 2)

  // merchant / memo from bank
  description String

  note String?
  date DateTime

  user     User      @relation(fields: [userId], references: [id])
  account  Account   @relation(fields: [accountId], references: [id])
  category Category? @relation(fields: [categoryId], references: [id])
  budget   Budget?   @relation(fields: [budgetId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}
